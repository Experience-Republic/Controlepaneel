<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="index.css" />
        <script defer type="module" src="index.js"></script>
        <!-- Import the urls from the index.js module -->
        <script type="module">
            import { urls } from './urls.js';
            // Make them globally available.
            window.urls = urls;
        </script>
    </head>
    <body>
        <div
            class="bg-indigo-500 w-1/6 text-center rounded-lg mx-auto timer"
            x-data="timer(new Date().setMinutes(new Date().getMinutes() + 10))"
            x-init="init();"
        >
            <h1
                class="m-10 text-6xl text-white"
                x-text="time().minutes+':'+time().seconds"
            ></h1>
        </div>
        <div class="flex flex-row">
            <div class="flex flex-col items-center w-1/2">
                <img
                    x-data
                    :src="$store.images.image_1"
                    alt="1"
                    class="m-2 w-1/4"
                />
                <img x-data :src="$store.images.image_2" alt="2" class="m-2 w-1/4" />
            </div>
            <div class="flex flex-col items-center w-1/2">
                <img x-data :src="$store.images.image_3" alt="3" class="m-2 w-1/4" />
                <img x-data :src="$store.images.image_4" alt="4" class="m-2 w-1/4" />
            </div>
        </div>
        <div x-data="{ code: '' }" class="flex items-center justify-center">
            <form x-data @submit.prevent="submitHandler(code)">
                <input
                    x-model="code"
                    maxlength="4"
                    type="text"
                    class="border-2 px-4 py-2 border border-gray-300 rounded-md"
                    placeholder="Enter Code"
                />
            </form>
        </div>
        <!-- A background image -->
        <!-- A button that says "Press enter to start" -->
        <!-- A popup that pops up when a wrong code is entered, indicating a time penalty -->
        <script>
            function timer(expiry) {
                return {
                    expired: false, // Whether the timer has expired
                    expiry: expiry,
                    remaining: null,
                    init() {
                        this.setRemaining()
                        // Update every second until the timer expires
                        setInterval(() => {
                            this.setRemaining()
                        }, 1000)
                    },
                    setRemaining() {
                        const diff = this.expiry - new Date().getTime()
                        // If the timer has expired, set the remaining time to 0, otherwise set it to the difference
                        if (diff <= 0) {
                            this.expired = true
                            this.remaining = 0
                        } else if (diff > 0) {
                            this.remaining = parseInt(diff / 1000)
                        }
                    },
                    days() {
                        return {
                            value: this.remaining / 86400,
                            remaining: this.remaining % 86400,
                        }
                    },
                    hours() {
                        return {
                            value: this.days().remaining / 3600,
                            remaining: this.days().remaining % 3600,
                        }
                    },
                    minutes() {
                        return {
                            value: this.hours().remaining / 60,
                            remaining: this.hours().remaining % 60,
                        }
                    },
                    seconds() {
                        return {
                            value: this.minutes().remaining,
                        }
                    },
                    format(value) {
                        return ('0' + parseInt(value)).slice(-2)
                    },
                    time() {
                        return {
                            expired: this.expired,
                            days: this.format(this.days().value),
                            hours: this.format(this.hours().value),
                            minutes: this.format(this.minutes().value),
                            seconds: this.format(this.seconds().value),
                        }
                    },
                }
            }

            function submitHandler(code) {
            // When the form is submitted, verify the code. There are four correct codes: (0001, 0002, 0003, 0004), corresponding to the matching images. If the code is correct, we use the $store
            if(code === "0001") {
                // Print the value of the alpine store variable
                Alpine.store('images').image_1 = urls.image_1;
            } else if(code === "0002") {
                Alpine.store('images').image_2 = urls.image_2;
            } else if(code === "0003") {
                Alpine.store('images').image_3 = urls.image_3;
            } else if(code === "0004") {
                Alpine.store('images').image_4 = urls.image_4;
            } else {
            // If the code is incorrect we subtract 10 seconds from the timer.
            console.log("Incorrect code!");
            }}
        </script>
    </body>
</html>
